USA_depression_clear_all = {
	remove_ideas = {
		great_depression
		great_depression_2
		great_depression_3
	}
}
USA_great_depression_level_up = {
	custom_effect_tooltip = USA_great_depression_up_tt
	if = {
		limit = { has_idea = great_depression_2 }
		swap_ideas = {
			remove_idea = great_depression_2
			add_idea = great_depression
		}
	}
	else_if = {
		limit = { has_idea = great_depression_3 }
		swap_ideas = {
			remove_idea = great_depression_3
			add_idea = great_depression_2
		}
	}
}
USA_great_depression_level_down = {
	if = {
		limit = { has_idea = great_depression_3 }
		custom_effect_tooltip = USA_great_depression_down_tt
		remove_ideas = great_depression_3
	}
	if = {
		limit = { has_idea = great_depression_2 }
		custom_effect_tooltip = USA_great_depression_down_tt
		swap_ideas = {
			remove_idea = great_depression_2
			add_idea = great_depression_3
		}
	}
	if = {
		limit = { has_idea = great_depression }
		custom_effect_tooltip = USA_great_depression_down_tt
		swap_ideas = {
			remove_idea = great_depression
			add_idea = great_depression_2
		}
	}
}
USA_set_president_effect = {
	if = {
		limit = {
			has_country_leader = { ruling_only = yes name = "Alf Landon" }
		}
		create_country_leader = {
			name = "Alf Landon"
			desc = "POLITICS_ALF_LANDON_DESC"
			picture = "portrait_USA_alf_landon.dds"
			expire = "1965.1.1"
			ideology = oligarchism
			traits = {
			}
		}
	}
	if = {
		limit = {
			has_country_leader = { ruling_only = yes name = "Wendell Wilkie" }
		}
		create_country_leader = {
			name = "Wendell Wilkie"
			desc = "POLITICS_WENDELL_WILKIE_DESC"
			picture = "Portrait_USA_Wendell_Willkie.dds"
			expire = "1965.1.1"
			ideology = oligarchism
			traits = {
			}
		}
	}
	if = {
		limit = {
			has_country_leader = { ruling_only = yes name = "Thomas E. Dewey" }
		}
		create_country_leader = {
			name = "Thomas E. Dewey"
			desc = "POLITICS_THOMAS_DEWEY_DESC"
			picture = "portrait_USA_thomas_dewey.dds"
			expire = "1965.1.1"
			ideology = oligarchism
			traits = {
			}
		}
	}
}
#Important to put HIGHEST first
USA_island_hopping_level_up = {
	
	if = {
		limit = { has_idea = USA_island_hopping14 }
		swap_ideas = {
			remove_idea = USA_island_hopping14
			add_idea = USA_island_hopping15
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping13 }
		swap_ideas = {
			remove_idea = USA_island_hopping13
			add_idea = USA_island_hopping14
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping12 }
		swap_ideas = {
			remove_idea = USA_island_hopping12
			add_idea = USA_island_hopping13
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping11 }
		swap_ideas = {
			remove_idea = USA_island_hopping11
			add_idea = USA_island_hopping12
		}
		set_variable = { global.ISLHOP_GEACPS_LOCATIONS = 0 }
		set_variable = { global.ISLHOP_ALLIES_LOCATIONS = 8 }
	}
	else_if = {
		limit = { has_idea = USA_island_hopping10 }
		swap_ideas = {
			remove_idea = USA_island_hopping10
			add_idea = USA_island_hopping11
		}
		set_variable = { global.ISLHOP_GEACPS_LOCATIONS = 1 }
		set_variable = { global.ISLHOP_ALLIES_LOCATIONS = 7 }
	}
	else_if = {
		limit = { has_idea = USA_island_hopping9 }
		swap_ideas = {
			remove_idea = USA_island_hopping9
			add_idea = USA_island_hopping10
		}
		set_variable = { global.ISLHOP_GEACPS_LOCATIONS = 2 }
		set_variable = { global.ISLHOP_ALLIES_LOCATIONS = 6 }
	}
	else_if = {
		limit = { has_idea = USA_island_hopping8 }
		swap_ideas = {
			remove_idea = USA_island_hopping8
			add_idea = USA_island_hopping9
		}
		set_variable = { global.ISLHOP_GEACPS_LOCATIONS = 3 }
		set_variable = { global.ISLHOP_ALLIES_LOCATIONS = 5 }
	}
	else_if = {
		limit = { has_idea = USA_island_hopping7 }
		swap_ideas = {
			remove_idea = USA_island_hopping7
			add_idea = USA_island_hopping8
		}
		set_variable = { global.ISLHOP_GEACPS_LOCATIONS = 4 }
		set_variable = { global.ISLHOP_ALLIES_LOCATIONS = 4 }
	}
	else_if = {
		limit = { has_idea = USA_island_hopping6 }
		swap_ideas = {
			remove_idea = USA_island_hopping6
			add_idea = USA_island_hopping7
		}
		set_variable = { global.ISLHOP_GEACPS_LOCATIONS = 5 }
		set_variable = { global.ISLHOP_ALLIES_LOCATIONS = 3 }
	}
	else_if = {
		limit = { has_idea = USA_island_hopping5 }
		swap_ideas = {
			remove_idea = USA_island_hopping5
			add_idea = USA_island_hopping6
		}
		set_variable = { global.ISLHOP_GEACPS_LOCATIONS = 6 }
		set_variable = { global.ISLHOP_ALLIES_LOCATIONS = 2 }
	}
	else_if = {
		limit = { has_idea = USA_island_hopping4 }
		swap_ideas = {
			remove_idea = USA_island_hopping4
			add_idea = USA_island_hopping5
		}
		set_variable = { global.ISLHOP_GEACPS_LOCATIONS = 7 }
		set_variable = { global.ISLHOP_ALLIES_LOCATIONS = 1 }
	}
	else_if = {
		limit = { has_idea = USA_island_hopping3 }
		swap_ideas = {
			remove_idea = USA_island_hopping3
			add_idea = USA_island_hopping4
		}
		set_variable = { global.ISLHOP_GEACPS_LOCATIONS = 8 }
		set_variable = { global.ISLHOP_ALLIES_LOCATIONS = 0 }
	}
	else_if = {
		limit = { has_idea = USA_island_hopping2 }
		swap_ideas = {
			remove_idea = USA_island_hopping2
			add_idea = USA_island_hopping3
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping1 }
		swap_ideas = {
			remove_idea = USA_island_hopping1
			add_idea = USA_island_hopping2
		}
	}
}

# Like the level up effect except it runs in reverse
USA_island_hopping_level_down = {
	if = {
		limit = { has_idea = USA_island_hopping1 }
		remove_ideas = USA_island_hopping1
	}
	else_if = {
		limit = { has_idea = USA_island_hopping2 }
		swap_ideas = {
			remove_idea = USA_island_hopping2
			add_idea = USA_island_hopping1
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping3 }
		swap_ideas = {
			remove_idea = USA_island_hopping3
			add_idea = USA_island_hopping2
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping4 }
		swap_ideas = {
			remove_idea = USA_island_hopping4
			add_idea = USA_island_hopping3
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping5 }
		swap_ideas = {
			remove_idea = USA_island_hopping5
			add_idea = USA_island_hopping4
		}		
	}
	else_if = {
		limit = { has_idea = USA_island_hopping6 }
		swap_ideas = {
			remove_idea = USA_island_hopping6
			add_idea = USA_island_hopping5
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping7 }
		swap_ideas = {
			remove_idea = USA_island_hopping7
			add_idea = USA_island_hopping6
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping8 }
		swap_ideas = {
			remove_idea = USA_island_hopping8
			add_idea = USA_island_hopping7
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping9 }
		swap_ideas = {
			remove_idea = USA_island_hopping9
			add_idea = USA_island_hopping8
		}		
	}
	else_if = {
		limit = { has_idea = USA_island_hopping10 }
		swap_ideas = {
			remove_idea = USA_island_hopping10
			add_idea = USA_island_hopping9
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping11 }
		swap_ideas = {
			remove_idea = USA_island_hopping11
			add_idea = USA_island_hopping10
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping12 }
		swap_ideas = {
			remove_idea = USA_island_hopping12
			add_idea = USA_island_hopping11
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping13 }
		swap_ideas = {
			remove_idea = USA_island_hopping13
			add_idea = USA_island_hopping12
		}		
	}
	else_if = {
		limit = { has_idea = USA_island_hopping14 }
		swap_ideas = {
			remove_idea = USA_island_hopping14
			add_idea = USA_island_hopping13
		}
	}
	else_if = {
		limit = { has_idea = USA_island_hopping15 }
		swap_ideas = {
			remove_idea = USA_island_hopping15
			add_idea = USA_island_hopping14
		}
	}
}

update_usa_relative_industry = {

    remove_dynamic_modifier = { modifier = relative_industrial_capacity_factory }

	set_temp_variable = { xr = modifier@industrial_capacity_factory }
	subtract_from_temp_variable = { xr = usa_rel_ic_baseline }
	set_variable = { usa_rel_ic_target = xr }

	if = { limit = { check_variable = { usa_rel_ic_target > 0.30 } } set_variable = { usa_rel_ic_target = 0.30 } }
	if = { limit = { check_variable = { usa_rel_ic_target < -0.30 } } set_variable = { usa_rel_ic_target = -0.30 } }

	set_temp_variable = { xr = usa_rel_ic_target }
	subtract_from_temp_variable = { xr = usa_rel_ic_current }
	multiply_temp_variable = { xr = 0.01 }
	set_variable = { usa_rel_ic_delta = xr }

	if = { limit = { check_variable = { usa_rel_ic_delta > 0.0013 } } set_variable = { usa_rel_ic_delta = 0.0013 } }
	if = { limit = { check_variable = { usa_rel_ic_delta < -0.0013 } } set_variable = { usa_rel_ic_delta = -0.0013 } }

	add_to_variable = { usa_rel_ic_current = usa_rel_ic_delta }

	if = { limit = { check_variable = { usa_rel_ic_current > 0.30 } } set_variable = { usa_rel_ic_current = 0.30 } }
	if = { limit = { check_variable = { usa_rel_ic_current < -0.30 } } set_variable = { usa_rel_ic_current = -0.30 } }

	set_variable = { relative_industrial_capacity_factory_actual = usa_rel_ic_current }
	add_dynamic_modifier = { modifier = relative_industrial_capacity_factory }

    # log
    add_to_variable = { usa_rel_ic_calls = 1 }
    log = "[USA RIC] calls=[?usa_rel_ic_calls] base=[?usa_rel_ic_base] cap=[?usa_rel_ic_cap] current=[?usa_rel_ic_current] target=[?usa_rel_ic_target] delta=[?usa_rel_ic_delta]"
}

update_dockyard_overcap_usa = {

    set_variable = { var = dy_over value = num_of_naval_factories }
    subtract_from_variable = { var = dy_over value = 100 }
    clamp_variable = { var = dy_over min = 0 max = 100000 }

    set_variable = { var = USA_production_speed_dockyard_factor value = dy_over }
    divide_variable = { var = USA_production_speed_dockyard_factor value = 150 }
    multiply_variable = { var = USA_production_speed_dockyard_factor value = -0.99 }

    clamp_variable = { var = USA_production_speed_dockyard_factor min = -0.99 max = 0 }
}

usa_start_rubber_relocation = {
	if = { limit = { has_country_flag = usa_rubber_relocating } }
	else = {
    	set_country_flag = usa_rubber_relocating
    	set_variable = { usa_rubber_left = 1500 }
	}
}

usa_weekly_rubber_relocation = {

	if = {
    	limit = { check_variable = { usa_rubber_left <= 0 } }
    	clr_country_flag = usa_rubber_relocating
  	}
  	else = {

    set_temp_variable = { move = 50 }

    if = {
      	limit = { check_variable = { usa_rubber_left < move } }
      	set_temp_variable = { move = usa_rubber_left }
    }

    if = {
      	limit = {
        	NOT = {
        	any_state = {
            	has_state_flag = philippines_rubber
            	is_controlled_by = USA
          		}
        	}
      	}
      	clr_country_flag = usa_rubber_relocating
    }
    else = {
    	set_temp_variable = { move_neg = move }
      	multiply_temp_variable = { move_neg = -1 }

      	random_state = {
        	limit = {
          		has_state_flag = philippines_rubber
          		is_controlled_by = USA
        	}
        	add_resource = { type = rubber amount = move_neg }
      	}

      	random_state = {
        	limit = { has_state_flag = usa_rubber }
        	add_resource = { type = rubber amount = move }
      	}

      	subtract_from_variable = { usa_rubber_left = move }
    	}
  	}
}

